<?xml version="1.0" encoding="UTF-8"?>
<project name="ABC:Core:SDK" xmlns:ac="http://ant-contrib.sourceforge.net">

    <!--
        Entry point, which any extension has to call first

        This macro defines certain extension based variables, like its directory,
        its resource directory and so on. Furthermore the extension default
        properties will be loaded, if available.

        Using this macro instead of doing everything by oneself ensures all
        necessary steps are executed in the correct order.
    -->
    <macrodef name="abc-extension-init">
        <attribute name="extension" />
        <attribute name="has-resources" default="" />

        <sequential>
            <ac:if>
                <istrue value="@{has-resources}" />
                <ac:then>
                    <ABC-Core-SDK-Resource-Directory extension="@{extension}"
                                                     property="@{extension}.Resources.Directory" />
                </ac:then>
            </ac:if>

            <ABC-Core-SDK-Extension-Directory extension="@{extension}"
                                              property="@{extension}.Directory" />

            <property file="@{extension}.Directory/Extension.properties" />
        </sequential>
    </macrodef>

    <!--
        Macro that determines the directory of a given extension.
    -->
    <macrodef name="ABC-Core-SDK-Extension-Directory">
        <attribute name="extension" />
        <attribute name="property" />

        <sequential>
            <ac:propertycopy property="@{property}#Extension.File"
                             from="ant.file.@{extension}" />
            <dirname property="@{property}"
                     file="${@{property}#Extension.File}" />
        </sequential>
    </macrodef>

    <!--
        Macro that determines the "Resources" directory of a given extension.
    -->
    <macrodef name="ABC-Core-SDK-Resources-Directory">
        <attribute name="extension" />
        <attribute name="property" />
        <sequential>
            <ABC-Core-SDK-Extension-Directory extension="@{extension}"
                                               property="@{property}#Extension.Directory" />

            <property name="@{property}"
                      location="${@{property}#Extension.Directory}/Resources" />

            <fail message="The requested 'Resources' directory does not exist for extension '@{extension}'.">
                <condition>
                    <not>
                        <available file="${@{property}}" type="dir" />
                    </not>
                </condition>
            </fail>
        </sequential>
    </macrodef>

</project>
