<?xml version="1.0" encoding="UTF-8"?>
<project name="ant-build-commons-extensions-phplint" basedir=".">
    <!--
        Import default properties for this extension.
    -->
    <property file="${resourcedir}/extensions/phplint/phplint.properties" />

    <!--
        Import utilized extensions
    -->
    <import file="enabled.xml" />
    <import file="availability.xml" />

    <!--
        Shortcut for the "phplint:phplint" target
    -->
    <target name="phplint" depends="phplint:phplint" />

    <!--
         External entrypoint
    -->
    <target name="phplint:phplint"
            depends="availability:php-srcdir-is-available"
            if="availability:php-srcdir-is-available">
        <common.enabled.antcall target="-phplint:phplint"
                                property="phplint.enabled" />
    </target>

    <!--
        Runs the linter check of php against the project source code.
    -->
    <target name="-phplint:phplint"
            depends="-phplint:before~hook,
                     -phplint:run,
                     -phplint:after~hook" />

    <!--
        Compiles all source and test source files of the current project.
    -->
    <target name="-phplint:run">
        <apply executable="${commons.executable.php}"
               failonerror="true"
               output="${commons:logsdir}/phplint.log">
            <arg value="-l" />
            <fileset dir="${commons.srcdir.php}" erroronmissingdir="false">
                <include name="**/*.php" />
                <modified>
                    <param name="cache.cachefile" value="${phplint.cachefile}" />
                </modified>
            </fileset>
            <fileset dir="${commons.testdir.php}" erroronmissingdir="false">
                <include name="**/*.php" />
                <exclude name="**/_source/**" />
                <exclude name="**/_files/**" />
                <exclude name="**/_code/**" />
                <exclude name="**/_fixture/**" />
                <exclude name="**/_fixtures/**" />
                <modified>
                    <param name="cache.cachefile" value="${compile.cachefile}" />
                </modified>
            </fileset>
        </apply>
    </target>

    <!--
         Extension points of this module
    -->
    <extension-point name="-phplint:before~hook" />
    <extension-point name="-phplint:after~hook" />

    <!--
         Hook this extension into the compile step
    -->
    <target name="-phplint:compile:main~hooked"
            extensionOf="-compile:main~hook"
            depends="phplint:phplint" />
</project>
