<?xml version="1.0" encoding="UTF-8"?>
<project name="ant-build-commons-base" basedir=".">

    <!--
        Declare basedir for commons
    -->
    <dirname property="-commons:basedir" file="${ant.file.ant-build-commons-base}" />

    <!--
        Define the build commons base directory.
    -->
    <property name="commons:basedir" location="${-commons:basedir}/../../" />

    <!--
        Define the build commons main source directory.
    -->
    <property name="commons:sourcedir" location="${commons:basedir}/main/xml" />

    <!--
        Define the build commons resource directory
    -->
    <property name="commons:resourcedir" location="${commons:basedir}/main/resources" />

    <!-- (DEPRECATED)
        Define minimum set of required properties
    -->
    <property name="resourcedir" location="${commons:resourcedir}" />

    <!--
        Import default properties. You should customize this properties in your
        own build environment.
    -->
    <property file="${commons:resourcedir}/base.properties" />

    <!--
        Some common settings for all project.
    -->
    <property name="commons:builddir" location="${commons.basedir}/${commons.builddir.name}" />
    <property name="commons:distdir"  location="${commons:builddir}/${commons.distdir.name}" />
    <property name="commons:logsdir"  location="${commons:builddir}/${commons.logsdir.name}" />
    <property name="commons:tmpdir"   location="${commons:builddir}/${commons.tempdir.name}" />

    <import file="clean.xml" />
    <import file="deploy.xml" />
    <import file="profile.xml" />
    <import file="project.xml" />
    <import file="site.xml" />

    <!--
        Import commons build extensions
    -->
    <import file="exts/changes.xml" />
    <import file="exts/pear.xml" />
    <import file="exts/scm.xml" />

    <!--
        Common build variables
    -->
    <tstamp>
        <format property="build.date" pattern="yyyy-MM-dd" />
    </tstamp>

    <!--
        Tests if the project build should run offline. To force an offline build
        you can supply the ${offline} property with "true", "on" or "1" to the
        ant command line:

        ~ $ ant verify -Doffline=1
        ~ $ ant verify -Doffline=on
        ~ $ ant verify -Doffline=true
    -->
    <target name="-commons:is-offline-mode">
        <condition property="commons:run-offline">
            <or>
                <equals arg1="${offline}" arg2="1" trim="true" />
                <equals arg1="${offline}" arg2="on" trim="true" />
                <equals arg1="${offline}" arg2="true" trim="true" />
            </or>
        </condition>
    </target>

    <!--
        Hooks right before the validate step.
    -->
    <target name="-commons:validate:before~hooked"
            depends="-commons:is-offline-mode"
            extensionOf="-validate:before~hook" />

</project>
